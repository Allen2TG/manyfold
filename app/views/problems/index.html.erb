<h1><%= Problem.model_name.human(count: 100) %></h1>

<%= render "filters" %>

<%= paginate @problems %>

<% if @problems.empty? %>
  <div class="alert alert-info">
    <%= t(".no_problems") %>
  </div>
<% end %>

<%= form_with url: resolve_problems_path, method: :post, class: "mb-3" do |form| %>
  <table class="table table-striped" data-bulk-edit>
    <% @problems.each do |problem| %>
      <% next unless problem.problematic %>
      <tr class="table-<%= problem_severity(problem) %> <%= problem.ignored && "opacity-50" %>">
        <td><%= icon(problem.icon, "") %></td>
        <% if problem.parent %>
          <td><%= link_to problem.parent.name, problem.parent, class: "link-dark" %></td>
          <td><%= link_to problem.problematic.name, [problem.parent, problem.problematic], class: "link-dark" %></td>
        <% else %>
          <td colspan=2><%= link_to problem.problematic.name, problem.problematic, class: "link-dark" %></td>
        <% end %>
        <td>
          <%= t "problems.%{type}.%{category}.title" % {type: problem.problematic_type.underscore, category: problem.category} %>
          <% if problem.note %>
            <br>
            <small><%= problem.note %></small>
          <% end %>
        </td>
        <td><%= render ResolveButtonComponent.new(problem: problem, user: current_user) %></td>
        <td>
          <% if problem.ignored %>
            <%= link_to icon("eye-fill", t(".unignore")), problem_path(problem, problem: {ignored: false}), method: :patch, class: "btn btn-outline-secondary" %>
          <% else %>
            <%= link_to icon("eye-slash", t(".ignore")), problem_path(problem, problem: {ignored: true}), method: :patch, class: "btn btn-outline-secondary" %>
          <% end %>
        </td>
      </tr>
    <% end %>
  </table>
<% end %>

<%= paginate @problems %>
